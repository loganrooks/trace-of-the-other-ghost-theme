{{!< default}}

{{!-- The "post" under erasure --}}
<article class="post-single {{post_class}}" data-post-id="{{id}}">
    {{!-- Post header with authorship troubles --}}
    <header class="post-header">
        {{#if feature_image}}
        <div class="post-feature-image">
            <img src="{{img_url feature_image size="xl"}}" alt="{{#if feature_image_alt}}{{feature_image_alt}}{{else}}{{title}}{{/if}}">
            <div class="image-critique">
                <span class="image-note">[This image was selected, cropped, positioned - each choice is violence]</span>
            </div>
        </div>
        {{/if}}

        {{!-- Title as palimpsest --}}
        <h1 class="post-title palimpsest-container" 
            data-layer-1="{{title}}"
            data-timestamp-1="{{date format="YYYY-MM-DD"}}">
            <span class="title-current">{{title}}</span>
            <span class="title-question">(But was this always the title?)</span>
        </h1>

        {{!-- Meta information under critique --}}
        <div class="post-meta">
            <div class="post-byline">
                {{!-- Authors with questioning --}}
                <div class="post-authors">
                    {{#foreach authors}}
                    <div class="author-attribution">
                        {{#if profile_image}}
                        <img class="author-image" src="{{img_url profile_image size="xs"}}" alt="{{name}}">
                        {{/if}}
                        <span class="author-name troubled-author">
                            <span class="original-author">{{name}}</span>
                            <span class="question-author">?</span>
                            <span class="author-fragments">[+Platform +Database +Reader +Tradition]</span>
                        </span>
                    </div>
                    {{#unless @last}}, {{/unless}}
                    {{/foreach}}
                </div>

                {{!-- Temporal information --}}
                <div class="post-temporal">
                    <time class="post-date" datetime="{{date format="YYYY-MM-DD"}}">
                        <span class="published-date">{{date format="MMM DD, YYYY"}}</span>
                        {{#if updated_at}}
                        <span class="updated-note">
                            (Updated {{date updated_at format="MMM DD, YYYY"}} - previous version erased)
                        </span>
                        {{/if}}
                    </time>
                    
                    {{!-- Reading time with critique --}}
                    <span class="reading-time">
                        {{reading_time}} min read
                        <span class="time-critique">(Assuming linear reading)</span>
                    </span>
                </div>
            </div>

            {{!-- Tags as questionable categories --}}
            {{#if tags}}
            <div class="post-tags">
                {{#foreach tags}}
                <a href="{{url}}" class="tag-link" rel="tag">{{name}}</a>
                {{#unless @last}} · {{/unless}}
                {{/foreach}}
                <span class="categorization-critique">[Categories impose order on chaos]</span>
            </div>
            {{/if}}
        </div>
    </header>

    {{!-- The content area with marginal spaces --}}
    <div class="post-content-container">
        {{!-- Left margin for voices --}}
        <aside class="post-margin-left">
            <div class="margin-voices-left" data-post-id="{{id}}">
                {{!-- Marginalia will be inserted here by JavaScript --}}
            </div>
        </aside>

        {{!-- Main content under deconstruction --}}
        <div class="post-content main-text">
            {{!-- Content with palimpsest potential --}}
            <div class="content-palimpsest">
                {{content}}
            </div>

            {{!-- Platform limitation markers within content --}}
            {{#if @custom.ghost_limitations_visible}}
            <div class="content-limitation-marker">
                <p class="limitation-text">
                    [This content was stored in a Ghost database, retrieved via SQL queries, 
                    rendered through Handlebars templates, and served via Node.js. 
                    Each layer shapes what you read.]
                </p>
            </div>
            {{/if}}
        </div>

        {{!-- Right margin for voices --}}
        <aside class="post-margin-right">
            <div class="margin-voices-right" data-post-id="{{id}}">
                {{!-- Marginalia will be inserted here by JavaScript --}}
            </div>
        </aside>
    </div>

    {{!-- Post footer --}}
    <footer class="post-footer">
        {{!-- Share buttons under question --}}
        <div class="post-share">
            <h4 class="share-title">Share this post <span class="share-critique">(But what does sharing mean?)</span></h4>
            <div class="share-buttons">
                <a class="share-twitter" href="https://twitter.com/intent/tweet?text={{encode title}}&url={{url absolute="true"}}" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" rel="noopener">
                    <span class="share-text">Twitter</span>
                    <span class="share-question">(280 character violence)</span>
                </a>
                <a class="share-facebook" href="https://www.facebook.com/sharer/sharer.php?u={{url absolute="true"}}" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" rel="noopener">
                    <span class="share-text">Facebook</span>
                    <span class="share-question">(Surveillance as sharing)</span>
                </a>
            </div>
        </div>

        {{!-- Author bio with questioning --}}
        {{#foreach authors}}
        <div class="author-bio">
            {{#if profile_image}}
            <div class="author-bio-image">
                <img src="{{img_url profile_image size="s"}}" alt="{{name}}">
            </div>
            {{/if}}
            <div class="author-bio-content">
                <h4 class="author-bio-name">
                    {{name}}
                    <span class="bio-question">(But who writes through them?)</span>
                </h4>
                {{#if bio}}
                <p class="author-bio-text">{{bio}}</p>
                {{/if}}
                {{#if website}}
                <p class="author-bio-link">
                    <a href="{{website}}" target="_blank" rel="noopener">{{website}}</a>
                </p>
                {{/if}}
            </div>
        </div>
        {{/foreach}}

        {{!-- Navigation to other posts --}}
        <nav class="post-navigation">
            {{#prev_post}}
            <div class="post-nav-prev">
                <a href="{{url}}" rel="prev">
                    <span class="nav-label">Previous Post</span>
                    <span class="nav-title">{{title}}</span>
                </a>
                <span class="nav-critique">(Linear progression assumed)</span>
            </div>
            {{/prev_post}}

            {{#next_post}}
            <div class="post-nav-next">
                <a href="{{url}}" rel="next">
                    <span class="nav-label">Next Post</span>
                    <span class="nav-title">{{title}}</span>
                </a>
                <span class="nav-critique">(But why this order?)</span>
            </div>
            {{/next_post}}
        </nav>

        {{!-- Random post suggestion --}}
        <div class="aleatory-suggestion">
            <button class="random-navigation" onclick="navigateRandomly()">
                ⚃ Or read something random ⚃
            </button>
            <p class="random-explanation">
                <em>Resist Ghost's chronological tyranny</em>
            </p>
        </div>
    </footer>
</article>

{{!-- Comments section with impossibility notice --}}
<section class="post-comments">
    {{#if @custom.ghost_limitations_visible}}
    <div class="comment-impossibility-notice">
        <h3>The Impossibility of True Dialogue</h3>
        <p>Ghost's comment system (if enabled) enforces:</p>
        <ul>
            <li>Comments must follow posts (never precede)</li>
            <li>Comments must have authors (anonymous speech forbidden)</li>
            <li>Comments are subordinate (never equal to the post)</li>
            <li>Comments cannot modify the original</li>
            <li>The author retains deletion power</li>
        </ul>
        <p><em>This is not a conversation. It is a monologue with permitted responses.</em></p>
    </div>
    {{/if}}

    {{!-- Actual comments would go here if enabled --}}
    {{!-- But we mark their structural violence --}}
    <div class="comment-absence">
        <p class="absence-notice">
            [Comments disabled or nonexistent. Your reading leaves no public trace.]
        </p>
        <p class="dialogue-critique">
            [True dialogue would allow you to rewrite this text.]
        </p>
    </div>
</section>

{{!-- Related posts with rhizomatic suggestion --}}
<section class="related-posts">
    <h3 class="related-title">
        Related Posts
        <span class="relation-critique">(Ghost's algorithm determines "relation")</span>
    </h3>
    
    {{#get "posts" filter="tag:{{primary_tag.slug}}+id:-{{id}}" limit="3" as |related_posts|}}
    {{#if related_posts}}
    <div class="related-posts-grid">
        {{#foreach related_posts}}
        <article class="related-post-card">
            <h4><a href="{{url}}">{{title}}</a></h4>
            <p class="related-excerpt">{{excerpt words="20"}}</p>
            <time class="related-date">{{date format="MMM DD"}}</time>
        </article>
        {{/foreach}}
    </div>
    {{else}}
    <div class="no-relations">
        <p>No related posts found.</p>
        <p class="relation-failure">
            <em>(Ghost's tagging system fails to find connections. 
            All texts are related. None are related. 
            The database cannot capture true affinity.)</em>
        </p>
    </div>
    {{/if}}
    {{/get}}
</section>

<script>
// Post-specific JavaScript
document.addEventListener('DOMContentLoaded', function() {
    const postId = document.querySelector('.post-single').dataset.postId;
    
    // Initialize marginalia for this post
    if (window.MarginaliaSystem && {{@custom.margin_voices}}) {
        const marginalia = new MarginaliaSystem();
        marginalia.loadPostMarginalia(postId);
    }

    // Initialize palimpsest system
    if (window.PalimpsestSystem && {{@custom.palimpsest_depth}} > 0) {
        const palimpsest = new PalimpsestSystem({{@custom.palimpsest_depth}});
        palimpsest.processPostContent();
    }

    // Add reading tracking
    trackReadingProgress();

    console.log('Post loaded:', postId);
    console.log('This text exists within Ghost database constraints.');
});

function navigateRandomly() {
    // Get all posts from the site
    fetch('/ghost/api/v3/content/posts/?key=' + 'YOUR_CONTENT_API_KEY&limit=all')
        .then(response => response.json())
        .then(data => {
            const posts = data.posts.filter(post => post.id !== document.querySelector('.post-single').dataset.postId);
            if (posts.length > 0) {
                const randomPost = posts[Math.floor(Math.random() * posts.length)];
                window.location.href = randomPost.url;
            }
        })
        .catch(() => {
            alert('Random navigation failed. The dice rolled off the table.');
        });
}

function trackReadingProgress() {
    let readingStartTime = Date.now();
    let maxScroll = 0;
    
    window.addEventListener('scroll', function() {
        const scrollPercent = Math.round((window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100);
        maxScroll = Math.max(maxScroll, scrollPercent);
    });

    window.addEventListener('beforeunload', function() {
        const readingTime = (Date.now() - readingStartTime) / 1000;
        console.log(`Reading session: ${readingTime}s, ${maxScroll}% scrolled`);
        console.log('This data is not preserved. Ghost does not track reading behavior.');
    });
}
</script>