<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Tooltip Positioning Test</title>
    <link rel="stylesheet" type="text/css" href="assets/css/footnote-themes.css">
    <style>
        body {
            font-family: 'JetBrains Mono', monospace;
            line-height: 1.6;
            margin: 0;
            padding: 40px;
            background: #0a0a0a;
            color: #00ff00;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            margin: 40px 0;
            padding: 20px;
            border: 1px dashed #333;
        }
        .test-footnote {
            background: #333;
            padding: 10px;
            margin: 10px;
            display: inline-block;
            cursor: pointer;
        }
        .edge-left { position: absolute; left: 20px; }
        .edge-right { position: absolute; right: 20px; }
        .edge-top { position: absolute; top: 20px; }
        .edge-bottom { position: fixed; bottom: 50px; }
        .center { text-align: center; }
        .post-content {
            position: relative;
            min-height: 200vh; /* Make page scrollable */
        }
        .footnote-system-enhanced {
            position: relative;
        }
        h2 {
            color: #00ff00;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
        }
        .test-note {
            color: #888;
            font-size: 0.9em;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Tooltip Positioning & Width Test</h1>
        <p class="test-note">Hover over footnotes to test edge positioning and width constraints. Desktop tooltips should be max 60% screen width, mobile tooltips fill available space.</p>
        
        <div class="viewport-info" style="position: fixed; top: 10px; right: 10px; background: #333; padding: 10px; font-size: 0.8em; border-radius: 4px; z-index: 2000;">
            <div>Viewport: <span id="viewport-size">Loading...</span></div>
            <div>Max Tooltip Width: <span id="max-tooltip-width">Calculating...</span></div>
        </div>
        
        <div class="post-content footnote-system-enhanced">
            <div class="test-section">
                <h2>Horizontal Edge Cases</h2>
                <div class="edge-left">
                    <span>Left edge footnote [^1] should not go off screen horizontally</span>
                </div>
                <div class="edge-right">
                    <span>Right edge footnote [^2] should not go off screen horizontally</span>
                </div>
            </div>
            
            <div class="test-section center">
                <h2>Center Positioning</h2>
                <p>This centered footnote [^3] should position normally when there's room.</p>
                <p>Multiple footnotes [^4] in center [^5] should work properly.</p>
            </div>
            
            <div class="test-section">
                <h2>Vertical Edge Cases</h2>
                <div class="edge-top">
                    <span>Top footnote [^6] can overflow above viewport</span>
                </div>
                <div class="edge-bottom">
                    <span>Bottom footnote [^7] can overflow below but stay usable</span>
                </div>
            </div>
            
            <div class="test-section center">
                <h2>Width Constraint Tests</h2>
                <p>This extremely long footnote [^8] tests desktop width limits and mobile responsiveness.</p>
            </div>
        </div>
    </div>

    <!-- Footnote content (HTML cards) -->
    <div data-ref="1">This is a footnote near the left edge. The tooltip should not extend beyond the left boundary of the screen, and the arrow should adjust accordingly.</div>
    <div data-ref="2">This is a footnote near the right edge. The tooltip should not extend beyond the right boundary of the screen, with proper arrow positioning.</div>
    <div data-ref="3">A normal centered footnote with standard positioning behavior. This should appear below the footnote marker with centered arrow.</div>
    <div data-ref="4">First of multiple footnotes in center area. Should position properly without interfering with other tooltips.</div>
    <div data-ref="5">Second footnote in center area. Testing multiple tooltips and their independent positioning.</div>
    <div data-ref="6">This footnote is near the top of the viewport. The tooltip should be allowed to extend above the viewport edge for reasonable scrolling access, but not so far as to be completely unusable.</div>
    <div data-ref="7">This footnote is near the bottom of the viewport. The tooltip may extend below the viewport but should remain within reasonable bounds for user accessibility. Very long tooltips like this one that contain multiple sentences and detailed explanations should still be positioned in a way that allows the user to scroll and read the content comfortably without it disappearing completely off screen. This tooltip is intentionally very long to test the width constraint behavior on desktop screens where it should be limited to 60% of viewport width.</div>
    <div data-ref="8">This is another extremely long footnote designed to test width constraints and word wrapping behavior. On desktop screens (wider than 768px), this tooltip should automatically wrap and limit itself to 60% of the viewport width, making it more vertical and readable rather than extending horizontally across the entire screen. On mobile devices, it should use the full available width with appropriate margins. The tooltip positioning system should account for this constrained width when calculating horizontal positioning to prevent overflow beyond screen edges.</div>

    <!-- Load footnote system -->
    <script src="assets/js/footnote-config.js"></script>
    <script src="assets/js/footnote-system.js"></script>
    
    <script>
        // Initialize test
        document.addEventListener('DOMContentLoaded', function() {
            // Create footnote system instance
            const footnoteSystem = new FootnoteSystem();
            
            // Add test info
            console.log('Tooltip positioning test loaded');
            console.log('Viewport size:', window.innerWidth, 'x', window.innerHeight);
            
            // Update viewport info display
            function updateViewportInfo() {
                const width = window.innerWidth;
                const height = window.innerHeight;
                const maxTooltipWidth = width > 768 ? Math.round(width * 0.6) + 'px (60vw)' : 'Full width (mobile)';
                
                document.getElementById('viewport-size').textContent = width + 'x' + height;
                document.getElementById('max-tooltip-width').textContent = maxTooltipWidth;
            }
            
            updateViewportInfo();
            
            // Add window resize handler to test responsive behavior
            let resizeTimeout;
            window.addEventListener('resize', function() {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(function() {
                    updateViewportInfo();
                    console.log('Viewport resized to:', window.innerWidth, 'x', window.innerHeight);
                }, 200);
            });
        });
    </script>
</body>
</html>