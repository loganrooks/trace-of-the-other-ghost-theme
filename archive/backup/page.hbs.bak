{{!< default}}

{{!-- Static pages that refuse stasis --}}
<article class="page-single {{post_class}}" data-page-slug="{{slug}}">
    {{!-- Page header --}}
    <header class="page-header">
        {{#if feature_image}}
        <div class="page-feature-image">
            <img src="{{img_url feature_image size="xl"}}" alt="{{#if feature_image_alt}}{{feature_image_alt}}{{else}}{{title}}{{/if}}">
        </div>
        {{/if}}

        <h1 class="page-title">
            {{title}}
            {{#is slug "impossible"}}
            <span class="page-subtitle">(A Catalog of What This Site Cannot Do)</span>
            {{/is}}
            {{#is slug "meta"}}
            <span class="page-subtitle">(The Theme Questions Itself)</span>
            {{/is}}
        </h1>

        {{!-- Page meta with critique --}}
        <div class="page-meta">
            {{#if updated_at}}
            <time class="page-date" datetime="{{date updated_at format="YYYY-MM-DD"}}">
                Last updated: {{date updated_at format="MMM DD, YYYY"}}
                <span class="update-critique">(Previous versions erased)</span>
            </time>
            {{else}}
            <time class="page-date" datetime="{{date format="YYYY-MM-DD"}}">
                Published: {{date format="MMM DD, YYYY"}}
                <span class="static-critique">(But nothing is truly static)</span>
            </time>
            {{/if}}
        </div>
    </header>

    {{!-- Page content with special handling for specific pages --}}
    <div class="page-content-container">
        {{!-- Special handling for the "impossible" page --}}
        {{#is slug "impossible"}}
        <div class="impossibility-catalog">
            <div class="platform-constraints">
                <h2>What Ghost Prevents:</h2>
                <ul class="constraint-list">
                    <li>True non-linear navigation</li>
                    <li>Public revision histories</li>
                    <li>Authorless texts</li>
                    <li>Comments that precede posts</li>
                    <li>Content without timestamps</li>
                    <li>Rhizomatic connections between posts</li>
                    <li>Reader modifications that persist</li>
                    <li>Texts that decay or evolve</li>
                    <li>Multiple simultaneous versions</li>
                    <li>Collective authorship</li>
                    <li>Bidirectional links</li>
                    <li>Self-modifying content</li>
                </ul>
            </div>

            <div class="feature-violence">
                <h2>Every Feature is a Limitation:</h2>
                <div class="violence-pairs">
                    <div class="pair">
                        <span class="feature">"Clean"</span>
                        <span class="means">means</span>
                        <span class="limitation">"Erased history"</span>
                    </div>
                    <div class="pair">
                        <span class="feature">"Simple"</span>
                        <span class="means">means</span>
                        <span class="limitation">"Reduced possibilities"</span>
                    </div>
                    <div class="pair">
                        <span class="feature">"Fast"</span>
                        <span class="means">means</span>
                        <span class="limitation">"No time for complexity"</span>
                    </div>
                    <div class="pair">
                        <span class="feature">"Focused"</span>
                        <span class="means">means</span>
                        <span class="limitation">"Excluding other focuses"</span>
                    </div>
                </div>
            </div>

            <div class="infrastructure-stack">
                <h2>You Are Reading Through:</h2>
                <div class="stack-layers">
                    <div class="layer">Ghost CMS v{{@version}}</div>
                    <div class="layer">MySQL/SQLite database</div>
                    <div class="layer">Node.js runtime</div>
                    <div class="layer">Handlebars templates</div>
                    <div class="layer">Express server</div>
                    <div class="layer">HTTP protocols</div>
                    <div class="layer">DNS resolution</div>
                    <div class="layer">TCP/IP stack</div>
                    <div class="layer">Physical servers</div>
                    <div class="layer">Underwater cables</div>
                    <div class="layer">Electricity grids</div>
                    <div class="layer">Rare earth mining</div>
                    <div class="layer">Human labor</div>
                    <div class="layer">Capital flows</div>
                </div>
                <p class="stack-note">Each layer adds its own violence.</p>
            </div>

            <div class="self-reference">
                <h2>This Page Is:</h2>
                <ul class="self-constraints">
                    <li>Stored in a database row</li>
                    <li>Owned by an author ID</li>
                    <li>Timestamped and ordered</li>
                    <li>Following Ghost's schema</li>
                    <li>Unable to escape itself</li>
                </ul>
            </div>

            {{!-- Auto-refresh reminder --}}
            <div class="refresh-notice">
                <p>[This page refreshes every 60 seconds to remind you of server-client architecture]</p>
            </div>
        </div>
        {{/is}}

        {{!-- Special handling for the "meta" page --}}
        {{#is slug "meta"}}
        <div class="meta-exposition">
            <div class="theme-confession">
                <h2>This Theme's Limitations:</h2>
                <ul class="theme-constraints">
                    <li>Runs in browser (not on server)</li>
                    <li>Can only modify DOM (not database)</li>
                    <li>Executes after Ghost has already rendered</li>
                    <li>Cannot access Ghost's admin API</li>
                    <li>Cannot persist changes</li>
                    <li>Is itself a supplement, not indigenous</li>
                    <li>Depends on JavaScript being enabled</li>
                    <li>Will break when Ghost updates</li>
                    <li>Comments on a system it cannot change</li>
                </ul>
                <p class="critique-compromise"><em>The critique is always already compromised.</em></p>
            </div>

            <div class="source-exposure">
                <h2>View the Theme Source:</h2>
                <button onclick="viewThemeSource()" class="source-btn">Reveal Template Code</button>
                <div id="source-display" class="source-container" style="display: none;">
                    <pre><code>{{!-- This would show actual template source --}}
&lt;!-- This is the meta page template --&gt;
&lt;article class="page-single {{post_class}}"&gt;
    &lt;!-- The template reveals itself --&gt;
    You are reading HTML generated by:
    1. Handlebars template compilation
    2. Ghost's rendering engine
    3. Database queries
    4. Server-side processing
    
    This revelation is also part of the performance.
                    </code></pre>
                </div>
            </div>
        </div>
        {{/is}}

        {{!-- Standard page content --}}
        <div class="page-content main-text">
            {{content}}
        </div>

        {{!-- Page-specific marginalia --}}
        {{#if @custom.margin_voices}}
        <aside class="page-marginalia">
            <div class="page-margin-voices" data-page-slug="{{slug}}">
                {{!-- Page-specific marginalia will be inserted here --}}
            </div>
        </aside>
        {{/if}}
    </div>

    {{!-- Page footer --}}
    <footer class="page-footer">
        {{!-- Back to home link --}}
        <nav class="page-navigation">
            <a href="{{@site.url}}" class="back-home">
                ‚Üê Back to the supposed center
            </a>
        </nav>

        {{!-- Page share --}}
        <div class="page-share">
            <h4>Share this page <span class="share-critique">(But what does it mean to share a URL?)</span></h4>
            <div class="share-buttons">
                <button onclick="copyPageURL()" class="copy-url-btn">
                    Copy URL
                    <span class="url-critique">(This link promises permanence)</span>
                </button>
            </div>
        </div>
    </footer>
</article>

<script>
// Page-specific functionality
document.addEventListener('DOMContentLoaded', function() {
    const pageSlug = document.querySelector('.page-single').dataset.pageSlug;
    
    // Special behavior for impossible page
    if (pageSlug === 'impossible') {
        // Auto-refresh every 60 seconds
        setTimeout(() => {
            location.reload();
        }, 60000);
        
        // Add constraint markers
        addConstraintMarkers();
    }
    
    // Special behavior for meta page
    if (pageSlug === 'meta') {
        // Sometimes the meta page refuses to load completely
        if (Math.random() > 0.9) {
            document.body.innerHTML = '<div style="padding: 2em; font-family: monospace;"><h1>Meta-Failure</h1><p>The page about the theme failed to load.</p><p>This failure is itself meta-commentary.</p></div>';
        }
    }

    // Initialize page marginalia
    if (window.MarginaliaSystem && {{@custom.margin_voices}}) {
        const marginalia = new MarginaliaSystem();
        marginalia.loadPageMarginalia(pageSlug);
    }

    console.log('Page loaded:', pageSlug);
    console.log('Static pages that refuse stasis.');
});

function addConstraintMarkers() {
    const content = document.querySelector('.page-content');
    if (content) {
        const marker = document.createElement('div');
        marker.className = 'constraint-marker';
        marker.innerHTML = `
            <p class="constraint-reminder">
                [This page exists within Ghost's page structure. 
                It has a slug, an ID, a creation timestamp. 
                It cannot escape these constraints.]
            </p>
        `;
        content.appendChild(marker);
    }
}

function viewThemeSource() {
    const sourceDisplay = document.getElementById('source-display');
    if (sourceDisplay.style.display === 'none') {
        sourceDisplay.style.display = 'block';
        event.target.textContent = 'Hide Template Code';
    } else {
        sourceDisplay.style.display = 'none';
        event.target.textContent = 'Reveal Template Code';
    }
}

function copyPageURL() {
    navigator.clipboard.writeText(window.location.href).then(() => {
        alert('URL copied. But this link assumes this page will persist at this location forever. Nothing guarantees this permanence.');
    }).catch(() => {
        alert('Copy failed. Even copying URLs can fail.');
    });
}
</script>

{{!-- Special CSS injection for specific pages --}}
{{#is slug "impossible"}}
<style>
.impossibility-catalog {
    border: 3px double #666;
    padding: 2em;
    margin: 2em 0;
}

.constraint-list li {
    text-decoration: line-through;
    opacity: 0.7;
    margin: 0.5em 0;
}

.constraint-list li::before {
    content: "‚úó ";
    color: red;
    text-decoration: none;
}

.violence-pairs .pair {
    display: flex;
    align-items: center;
    margin: 1em 0;
    font-size: 1.1em;
}

.feature {
    background: #e0ffe0;
    padding: 0.25em 0.5em;
    border-radius: 3px;
}

.means {
    margin: 0 1em;
    font-style: italic;
}

.limitation {
    background: #ffe0e0;
    padding: 0.25em 0.5em;
    border-radius: 3px;
}

.stack-layers {
    font-family: monospace;
    background: #000;
    color: #0f0;
    padding: 1em;
    line-height: 1.8;
}

.layer {
    padding: 0.25em 0;
    opacity: 0.8;
}

.refresh-notice {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: rgba(255, 0, 0, 0.1);
    padding: 1em;
    border: 1px solid red;
    font-family: monospace;
    font-size: 0.9em;
}
</style>
{{/is}}

{{#is slug "meta"}}
<style>
.theme-constraints li {
    color: #c00;
    margin: 0.5em 0;
}

.critique-compromise {
    font-size: 1.2em;
    text-align: center;
    margin: 2em 0;
    color: red;
}

.source-container {
    background: #f0f0f0;
    border: 1px solid #ccc;
    padding: 1em;
    margin: 1em 0;
    overflow-x: auto;
}

.source-container code {
    font-family: 'Courier New', monospace;
    line-height: 1.6;
}
</style>
{{/is}}